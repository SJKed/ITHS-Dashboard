{"ast":null,"code":"var readFile = require('fs').readFile,\n    basename = require('path').basename;\n\nexports.build = function (data, boundary, callback) {\n  if (typeof data != 'object' || typeof data.pipe == 'function') return callback(new Error('Multipart builder expects data as key/val object.'));\n  var body = '',\n      object = flatten(data),\n      count = Object.keys(object).length;\n  if (count === 0) return callback(new Error('Empty multipart body. Invalid data.'));\n\n  function done(err, section) {\n    if (err) return callback(err);\n    if (section) body += section;\n    --count || callback(null, body + '--' + boundary + '--');\n  }\n\n  ;\n\n  for (var key in object) {\n    var value = object[key];\n\n    if (value === null || typeof value == 'undefined') {\n      done();\n    } else if (Buffer.isBuffer(value)) {\n      var part = {\n        buffer: value,\n        content_type: 'application/octet-stream'\n      };\n      generate_part(key, part, boundary, done);\n    } else {\n      var part = value.buffer || value.file || value.content_type ? value : {\n        value: value\n      };\n      generate_part(key, part, boundary, done);\n    }\n  }\n};\n\nfunction generate_part(name, part, boundary, callback) {\n  var return_part = '--' + boundary + '\\r\\n';\n  return_part += 'Content-Disposition: form-data; name=\"' + name + '\"';\n\n  function append(data, filename) {\n    if (data) {\n      var binary = part.content_type.indexOf('text') == -1;\n      return_part += '; filename=\"' + encodeURIComponent(filename) + '\"\\r\\n';\n      if (binary) return_part += 'Content-Transfer-Encoding: binary\\r\\n';\n      return_part += 'Content-Type: ' + part.content_type + '\\r\\n\\r\\n';\n      return_part += binary ? data.toString('binary') : data.toString('utf8');\n    }\n\n    callback(null, return_part + '\\r\\n');\n  }\n\n  ;\n\n  if ((part.file || part.buffer) && part.content_type) {\n    var filename = part.filename ? part.filename : part.file ? basename(part.file) : name;\n    if (part.buffer) return append(part.buffer, filename);\n    readFile(part.file, function (err, data) {\n      if (err) return callback(err);\n      append(data, filename);\n    });\n  } else {\n    if (typeof part.value == 'object') return callback(new Error('Object received for ' + name + ', expected string.'));\n\n    if (part.content_type) {\n      return_part += '\\r\\n';\n      return_part += 'Content-Type: ' + part.content_type;\n    }\n\n    return_part += '\\r\\n\\r\\n';\n    return_part += Buffer.from(String(part.value), 'utf8').toString('binary');\n    append();\n  }\n} // flattens nested objects for multipart body\n\n\nfunction flatten(object, into, prefix) {\n  into = into || {};\n\n  for (var key in object) {\n    var prefix_key = prefix ? prefix + '[' + key + ']' : key;\n    var prop = object[key];\n    if (prop && typeof prop === 'object' && !(prop.buffer || prop.file || prop.content_type)) flatten(prop, into, prefix_key);else into[prefix_key] = prop;\n  }\n\n  return into;\n}","map":{"version":3,"names":["readFile","require","basename","exports","build","data","boundary","callback","pipe","Error","body","object","flatten","count","Object","keys","length","done","err","section","key","value","Buffer","isBuffer","part","buffer","content_type","generate_part","file","name","return_part","append","filename","binary","indexOf","encodeURIComponent","toString","from","String","into","prefix","prefix_key","prop"],"sources":["/mnt/c/users/46721/documents/iths/ITHS-Dashboard/node_modules/needle/lib/multipart.js"],"sourcesContent":["var readFile = require('fs').readFile,\n    basename = require('path').basename;\n\nexports.build = function(data, boundary, callback) {\n\n  if (typeof data != 'object' || typeof data.pipe == 'function')\n    return callback(new Error('Multipart builder expects data as key/val object.'));\n\n  var body   = '',\n      object = flatten(data),\n      count  = Object.keys(object).length;\n\n  if (count === 0)\n    return callback(new Error('Empty multipart body. Invalid data.'))\n\n  function done(err, section) {\n    if (err) return callback(err);\n    if (section) body += section;\n    --count || callback(null, body + '--' + boundary + '--');\n  };\n\n  for (var key in object) {\n    var value = object[key];\n    if (value === null || typeof value == 'undefined') {\n      done();\n    } else if (Buffer.isBuffer(value)) {\n      var part = { buffer: value, content_type: 'application/octet-stream' };\n      generate_part(key, part, boundary, done);\n    } else {\n      var part = (value.buffer || value.file || value.content_type) ? value : { value: value };\n      generate_part(key, part, boundary, done);\n    }\n  }\n\n}\n\nfunction generate_part(name, part, boundary, callback) {\n\n  var return_part = '--' + boundary + '\\r\\n';\n  return_part += 'Content-Disposition: form-data; name=\"' + name + '\"';\n\n  function append(data, filename) {\n\n    if (data) {\n      var binary = part.content_type.indexOf('text') == -1;\n      return_part += '; filename=\"' + encodeURIComponent(filename) + '\"\\r\\n';\n      if (binary) return_part += 'Content-Transfer-Encoding: binary\\r\\n';\n      return_part += 'Content-Type: ' + part.content_type + '\\r\\n\\r\\n';\n      return_part += binary ? data.toString('binary') : data.toString('utf8');\n    }\n\n    callback(null, return_part + '\\r\\n');\n  };\n\n  if ((part.file || part.buffer) && part.content_type) {\n\n    var filename = part.filename ? part.filename : part.file ? basename(part.file) : name;\n    if (part.buffer) return append(part.buffer, filename);\n\n    readFile(part.file, function(err, data) {\n      if (err) return callback(err);\n      append(data, filename);\n    });\n\n  } else {\n\n    if (typeof part.value == 'object')\n      return callback(new Error('Object received for ' + name + ', expected string.'))\n\n    if (part.content_type) {\n      return_part += '\\r\\n';\n      return_part += 'Content-Type: ' + part.content_type;\n    }\n\n    return_part += '\\r\\n\\r\\n';\n    return_part += Buffer.from(String(part.value), 'utf8').toString('binary');\n    append();\n\n  }\n\n}\n\n// flattens nested objects for multipart body\nfunction flatten(object, into, prefix) {\n  into = into || {};\n\n  for(var key in object) {\n    var prefix_key = prefix ? prefix + '[' + key + ']' : key;\n    var prop = object[key];\n\n    if (prop && typeof prop === 'object' && !(prop.buffer || prop.file || prop.content_type))\n      flatten(prop, into, prefix_key)\n    else\n      into[prefix_key] = prop;\n  }\n\n  return into;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}